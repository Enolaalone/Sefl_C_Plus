## 指定宽度对齐：

```c
 //指定宽度向上对齐
#define RT_ALIGN(size,align) 		(((size) + (align) -1) & ~((align) - 1)

//指定宽度向下对齐
#define RT_ALIGN_DOWN(size,align)	((size)&~((align)-1)) 
```

### 1. 指定宽度向上对齐

\#define RT_ALIGN(size,align) (((size) + (align) -1) & ~((align) - 1)

作用为将字节数size向上提升为align的整数倍， 就是以align为上界对齐的意思。
需要注意的是align要为2的幂次方。

- (size) + (align) - 1：align-1为size除以align的最大余数，用size去加它是为了便于向上取align的整数倍数值。
- ~((align) - 1)：为余数的掩码，将其&上(size) + (align) - 1即可清除其余数，得到align的整数倍数值。

举个 4k页面边界的例子，即align=4096： 如果size = 3888；那么以上界对齐，执行结果就是4096。 如果size = 4096；结果是4096. 如果size = 4222； 则结果为8192.

### 2. 指定宽度向下对齐

\#define RT_ALIGN_DOWN(size,align) ((size)&~((align)-1))
将字节数size向下提升到align的整数倍的， 就是以align为下界对齐的方式的意思。
举个 4k页面边界的例子，若size = 3888； 结果为0. 如果size = 4096；结果是4096. 如果size = 4222； 则结果为4096。

### 3. 计算示例

- RT_ALIGN（17,4）= 20

```c
(size) + (align) - 1 = 17 + 3 = 0001 0101
~((align) - 1) = ~(3) = ~(0000 0011)
0001 0101 & ~(0000 0011) = 0001 0100 = 20	// 将后两位清0，后两位即为最大余数3
```

上面说过align必须为2的n次幂，下面测试其不为2的n次幂时的错误用法：

- RT_ALIGN（17,3）

  正确结果：18
  实际运算结果：17

```c
(size) + (align) - 1 = 17 + 2 = 0001 0011
~((align) - 1) = ~(2) = ~(0000 0010)
0001 0011 & ~(0000 0010) = 0001 0001 = 17	
```

很明显，并没有完成三字节对齐，也就是说这个宏定义不能进行任意字节的对齐。不过我们一般都是四字节对齐八字节对齐，所以不能进行三字节对齐，七字节对齐，并没有什么影响。
应该是只有 1，2，4，8，16这种2的n次方才能用这个进行字节对齐。